/* ------------------------------------------------------------
 This is the file "helmholtzbem3d.h" of the H2Lib package.
 All rights reserved, Sven Christophersen 2015
 ------------------------------------------------------------ */

/**
 * @file helmholtzbem3d.h
 * @author Sven Christophersen
 * @date 2015
 */

#ifndef HELMHOLTZBEM3D_H_
#define HELMHOLTZBEM3D_H_

#ifdef USE_COMPLEX

/* C STD LIBRARY */
/* CORE 0 */
/* CORE 1 */
/* CORE 2 */
/* CORE 3 */
/* SIMPLE */
/* PARTICLES */
/* BEM */
#include "bem3d.h"

/** \defgroup helmholtzbem3d helmholtzbem3d
 *  @brief This module contains functions to setup and solve boundary integral
 *  equations for the Helmholtz problem in 3D.
 *  @{ */

/** @brief Constant that originates from the fundamental solution of the
 * Helmholtz equation. The value is @f$ 1 / 4 \pi @f$
 */
#define KERNEL_CONST_HELMHOLTZBEM3D 0.0795774715459476679

/**
 * @brief Simple struct that containts the wavevector @f$\vec \kappa@f$ and some
 * source point.
 */
struct _helmholtz_data {
  /** @brief The wavevector @f$\vec \kappa@f$. */
  field *kvec;

  /** @brief Some source point. */
  real *source;
};

/**
 * @brief Typedef of the struct @ref _helmholtz_data.
 */
typedef struct _helmholtz_data helmholtz_data;

/**
 * @brief Creates a new @ref _bem3d "bem3d"-object for computation of
 * single layer potential matrix of the Helmholtz equation.
 *
 * After calling this function the resulting @ref _bem3d "bem"-object will
 * provide all functionality that is necessary to build up fully populated
 * single layer potential matrix @f$ V \in \mathbb R^{\mathcal I \times
 * \mathcal I}@f$ and also @ref _hmatrix "hmatrix"
 * or @ref _h2matrix "h2matrix" approximation of this matrix.
 *
 * @param kvec Three-dimensional vector of field representing the wavevector
 *   @f$\vec \kappa@f$.
 * @param gr Surface mesh
 * @param q_regular Order of gaussian quadrature used within computation of matrix
 *        entries for single integrals and regular double integrals.
 * @param q_singular Order of gaussian quadrature used within computation of matrix
 *        entries singular double integrals.
 * @param basis Type of basis functions used for neumann data.
 *
 * @return Returns a @ref _bem3d "bem"-object that can compute fully populated
 * slp matrices @f$ V @f$ for the helmholtz equation.
 */
HEADER_PREFIX pbem3d
new_slp_helmholtz_bem3d(field *kvec, pcsurface3d gr, uint q_regular,
    uint q_singular, basisfunctionbem3d basis);

/**
 * @brief Creates a new @ref _bem3d "bem3d"-object for computation of
 * double layer potential matrix plus a scalar times the mass matrix
 * of the Helmholtz equation.
 *
 * After calling this function the resulting @ref _bem3d "bem"-object will
 * provide all functionality that is necessary to build up fully populated
 * double layer potential matrix @f$ K + \frac{1}{2} M \in \mathbb
 * R^{\mathcal I \times \mathcal J}@f$ and also @ref _hmatrix "hmatrix"
 * or @ref _h2matrix "h2matrix"
 * approximation of this matrix.
 *
 * @param kvec Three-dimensional vector of field representing the wavevector
 *   @f$\vec \kappa@f$.
 * @param gr Surface mesh.
 * @param q_regular Order of gaussian quadrature used within computation of matrix
 *        entries for single integrals and regular double integrals.
 * @param q_singular Order of gaussian quadrature used within computation of matrix
 *        entries singular double integrals.
 * @param basis_neumann Type of basis functions used for neumann data.
 * @param basis_dirichlet Type of basis functions used for dirichlet data.
 * @param alpha Double layer operator + @f$\alpha@f$ mass matrix.
 *
 * @return Returns a @ref _bem3d "bem"-object that can compute fully populated
 * dlp matrices @f$ K + \alpha M @f$ for the laplace equation.
 */
HEADER_PREFIX pbem3d
new_dlp_helmholtz_bem3d(field * kvec, pcsurface3d gr,
    uint q_regular, uint q_singular, basisfunctionbem3d basis_neumann,
    basisfunctionbem3d basis_dirichlet, field alpha);

/**
 * @brief Delete a @ref _bem3d "bem3d" object for the Helmholtz equation
 *
 * @param bem Object to be deleted.
 */
HEADER_PREFIX void
del_helmholtz_bem3d(pbem3d bem);

/**
 * @brief A harmonic function based upon the fundamental solution,
 * that will serve as dirichlet values.
 *
 * When computing the neumann data out of the dirichlet data one can use this
 * function as test data which will generate dirichlet values of with the following
 * values:
 * @f[
 * f(\vec x, \, \vec n) = g(\vec x, \vec z)
 * @f]
 * where @f$\vec z@f$ is some arbitrarily chosen source point.
 * Corresponding neumann data can be generated by using
 * @ref rhs_neumann_point_helmholtzbem3d.
 * <br>
 * To build up an appropriate dirichlet data coefficient vector one needs the
 * @f$ L_2@f$-projection. This can be done by passing this function to
 * @ref projectl2_bem3d_const_avector for piecewise constant basis functions or
 * to @ref projectl2_bem3d_linear_avector for piecewise linear basis functions.
 *
 * @param x Evaluation point.
 * @param n Normal vector to current evaluation point.
 * @param data Additional data for evaluating the functional. Here a pointer to
 *   a @ref helmholtz_data object is expected.
 * @return returns the function value of @f$ f(\vec x, \, \vec n) @f$.
 */
HEADER_PREFIX field
rhs_dirichlet_point_helmholtzbem3d(const real *x,
    const real *n, const void *data);

/**
 * @brief A harmonic function based upon the fundamental solution,
 * that will serve as dirichlet values.
 *
 * When computing the dirichlet data out of the neumann data one can use this
 * function as test data which will generate neumann values of with the following
 * values:
 * @f[
 * f(\vec x, \, \vec n) = \frac{\partial g}{\partial \vec n}(\vec x, \vec z)
 * @f]
 * where @f$\vec z@f$ is some arbitrarily chosen source point.
 * Corresponding dirichlet data can be generated by using
 * @ref rhs_dirichlet_point_helmholtzbem3d.
 * <br>
 * To build up an appropriate neumann data coefficient vector one needs the
 * @f$ L_2@f$-projection. This can be done by passing this function to
 * @ref projectl2_bem3d_const_avector for piecewise constant basis functions or
 * to @ref projectl2_bem3d_linear_avector for piecewise linear basis functions.
 *
 * @param x Evaluation point.
 * @param n Normal vector to current evaluation point.
 * @param data Additional data for evaluating the functional. Here a pointer to
 *   a @ref helmholtz_data object is expected.
 * @return returns the function value of @f$ f(\vec x, \, \vec n) @f$.
 */
HEADER_PREFIX field
rhs_neumann_point_helmholtzbem3d(const real *x,
    const real *n, const void *data);

/**
 * @}
 */

#endif

#endif /* HELMHOLTZBEM3D_H_ */
